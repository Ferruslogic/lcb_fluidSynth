bplist00—XUTI-DataŸ	
_public.utf8-plain-text_$com.apple.traditional-mac-plain-text_com.apple.webarchive_com.adobe.indesign-import-styl_com.adobe.indesign-import-ustl[public.htmlZpublic.rtf_public.utf16-plain-text_ public.utf16-external-plain-text_hReal-time MIDI router

The MIDI router is one more processing layer directly behind the MIDI input. It processes incoming MIDI events and generates control events for the synth. It can be used to filter or modify events prior to sending them to the synthesizer. When created, the MIDI router is transparent and simply passes all MIDI events. Router "rules" must be added to actually make use of its capabilities.

Some examples of MIDI router usage:

Filter messages (Example: Pass sustain pedal CCs only to selected channels)
Split the keyboard (Example: noteon with notenr < x: to ch 1, >x to ch 2)
Layer sounds (Example: for each noteon received on ch 1, create a noteon on ch1, ch2, ch3,...)
Velocity scaling (Example: for each noteon event, scale the velocity by 1.27)
Velocity switching (Example: v <= 100: "Angel Choir"; v > 100: "Hell's Bells")
Get rid of aftertouch
The MIDI driver API has a clean separation between the midi thread and the synthesizer. That opens the door to add a midi router module.

MIDI events coming from the MIDI player do not pass through the MIDI router.

#include <fluidsynth.h>
int main(int argc, char** argv) 
{
    fluid_settings_t* settings;
    fluid_synth_t* synth;
    fluid_midi_router_t* router;
    fluid_midi_router_rule_t* rule;
    settings = new_fluid_settings();
    synth = new_fluid_synth(settings);
    /* Create the MIDI router and pass events to the synthesizer */
    router = new_fluid_midi_router (settings, fluid_synth_handle_midi_event, synth);
    /* Clear default rules */
    fluid_midi_router_clear_rules (router);
    /* Add rule to map all notes < MIDI note #60 on any channel to channel 4 */
    rule = new_fluid_midi_router_rule ();
    fluid_midi_router_rule_set_chan (rule, 0, 15, 0.0, 4);      /* Map all to channel 4 */
    fluid_midi_router_rule_set_param1 (rule, 0, 59, 1.0, 0);    /* Match notes < 60 */
    fluid_midi_router_add_rule (router, rule, FLUID_MIDI_ROUTER_RULE_NOTE);
    /* Add rule to map all notes >= MIDI note #60 on any channel to channel 5 */
    rule = new_fluid_midi_router_rule ();
    fluid_midi_router_rule_set_chan (rule, 0, 15, 0.0, 5);      /* Map all to channel 5 */
    fluid_midi_router_rule_set_param1 (rule, 60, 127, 1.0, 0);  /* Match notes >= 60 */
    fluid_midi_router_add_rule (router, rule, FLUID_MIDI_ROUTER_RULE_NOTE);
    /* Add rule to reverse direction of pitch bender on channel 7 */
    rule = new_fluid_midi_router_rule ();
    fluid_midi_router_rule_set_chan (rule, 7, 7, 1.0, 0);             /* Match channel 7 only */
    fluid_midi_router_rule_set_param1 (rule, 0, 16383, -1.0, 16383);  /* Reverse pitch bender */
    fluid_midi_router_add_rule (router, rule, FLUID_MIDI_ROUTER_RULE_PITCH_BEND);
    /* ... Create audio driver, process events, etc ... */
    /* cleanup */
    delete_fluid_midi_router(router);
    delete_fluid_synth(synth);
    delete_fluid_settings(settings);
    return 0;
}
O~Real-time MIDI routerThe MIDI router is one more processing layer directly behind the MIDI input. It processes incoming MIDI events and generates control events for the synth. It can be used to filter or modify events prior to sending them to the synthesizer. When created, the MIDI router is transparent and simply passes all MIDI events. Router "rules" must be added to actually make use of its capabilities.Some examples of MIDI router usage:	•	Filter messages (Example: Pass sustain pedal CCs only to selected channels)	•	Split the keyboard (Example: noteon with notenr < x: to ch 1, >x to ch 2)	•	Layer sounds (Example: for each noteon received on ch 1, create a noteon on ch1, ch2, ch3,...)	•	Velocity scaling (Example: for each noteon event, scale the velocity by 1.27)	•	Velocity switching (Example: v <= 100: "Angel Choir"; v > 100: "Hell's Bells")	•	Get rid of aftertouchThe MIDI driver API has a clean separation between the midi thread and the synthesizer. That opens the door to add a midi router module.MIDI events coming from the MIDI player do not pass through the MIDI router.#include <fluidsynth.h>int main(int argc, char** argv) {    fluid_settings_t* settings;    fluid_synth_t* synth;    fluid_midi_router_t* router;    fluid_midi_router_rule_t* rule;    settings = new_fluid_settings();    synth = new_fluid_synth(settings);    /* Create the MIDI router and pass events to the synthesizer */    router = new_fluid_midi_router (settings, fluid_synth_handle_midi_event, synth);    /* Clear default rules */    fluid_midi_router_clear_rules (router);    /* Add rule to map all notes < MIDI note #60 on any channel to channel 4 */    rule = new_fluid_midi_router_rule ();    fluid_midi_router_rule_set_chan (rule, 0, 15, 0.0, 4);      /* Map all to channel 4 */    fluid_midi_router_rule_set_param1 (rule, 0, 59, 1.0, 0);    /* Match notes < 60 */    fluid_midi_router_add_rule (router, rule, FLUID_MIDI_ROUTER_RULE_NOTE);    /* Add rule to map all notes >= MIDI note #60 on any channel to channel 5 */    rule = new_fluid_midi_router_rule ();    fluid_midi_router_rule_set_chan (rule, 0, 15, 0.0, 5);      /* Map all to channel 5 */    fluid_midi_router_rule_set_param1 (rule, 60, 127, 1.0, 0);  /* Match notes >= 60 */    fluid_midi_router_add_rule (router, rule, FLUID_MIDI_ROUTER_RULE_NOTE);    /* Add rule to reverse direction of pitch bender on channel 7 */    rule = new_fluid_midi_router_rule ();    fluid_midi_router_rule_set_chan (rule, 7, 7, 1.0, 0);             /* Match channel 7 only */    fluid_midi_router_rule_set_param1 (rule, 0, 16383, -1.0, 16383);  /* Reverse pitch bender */    fluid_midi_router_add_rule (router, rule, FLUID_MIDI_ROUTER_RULE_PITCH_BEND);    /* ... Create audio driver, process events, etc ... */    /* cleanup */    delete_fluid_midi_router(router);    delete_fluid_synth(synth);    delete_fluid_settings(settings);    return 0;}OsÑbplist00—_WebMainResource’	
_WebResourceData_WebResourceMIMEType_WebResourceTextEncodingName^WebResourceURL_WebResourceFrameNameOrr<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><h1 style="transition: text-shadow 0.5s linear; margin-right: 15px; caret-color: rgb(0, 0, 0); color: rgb(0, 0, 0); font-family: Roboto, sans-serif; font-style: normal; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none;">Real-time MIDI router</h1><p style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: 22px; font-family: Roboto, sans-serif; caret-color: rgb(0, 0, 0); color: rgb(0, 0, 0); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none;">The MIDI router is one more processing layer directly behind the MIDI input. It processes incoming MIDI events and generates control events for the synth. It can be used to filter or modify events prior to sending them to the synthesizer. When created, the MIDI router is transparent and simply passes all MIDI events. Router "rules" must be added to actually make use of its capabilities.</p><p style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: 22px; font-family: Roboto, sans-serif; caret-color: rgb(0, 0, 0); color: rgb(0, 0, 0); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none;">Some examples of MIDI router usage:</p><ul style="caret-color: rgb(0, 0, 0); color: rgb(0, 0, 0); font-family: Roboto, sans-serif; font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none;"><li>Filter messages (Example: Pass sustain pedal CCs only to selected channels)</li><li>Split the keyboard (Example: noteon with notenr &lt; x: to ch 1, &gt;x to ch 2)</li><li>Layer sounds (Example: for each noteon received on ch 1, create a noteon on ch1, ch2, ch3,...)</li><li>Velocity scaling (Example: for each noteon event, scale the velocity by 1.27)</li><li>Velocity switching (Example: v &lt;= 100: "Angel Choir"; v &gt; 100: "Hell's Bells")</li><li>Get rid of aftertouch</li></ul><p style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: 22px; font-family: Roboto, sans-serif; caret-color: rgb(0, 0, 0); color: rgb(0, 0, 0); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none;">The MIDI driver API has a clean separation between the midi thread and the synthesizer. That opens the door to add a midi router module.</p><p style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: 22px; font-family: Roboto, sans-serif; caret-color: rgb(0, 0, 0); color: rgb(0, 0, 0); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none;">MIDI events coming from the MIDI player do not pass through the MIDI router.</p><div class="fragment" style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: 22px; font-family: Roboto, sans-serif; padding: 0px; margin: 4px 8px 4px 2px; background-color: rgb(251, 252, 253); border: 1px solid rgb(196, 207, 229); caret-color: rgb(0, 0, 0); color: rgb(0, 0, 0); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none;"><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"><span class="preprocessor" style="color: rgb(128, 96, 32);">#include &lt;fluidsynth.h&gt;</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"><span class="keywordtype" style="color: rgb(96, 64, 32);">int</span> main(<span class="keywordtype" style="color: rgb(96, 64, 32);">int</span> argc, <span class="keywordtype" style="color: rgb(96, 64, 32);">char</span>** argv) </div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">{</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="types_8h.html#aa363402d3c77333b0f070ba531d034ba" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_settings_t</a>* settings;</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="types_8h.html#ae265f10ae174a13afe010de50d87e1a4" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_synth_t</a>* synth;</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="types_8h.html#aa57b4746220e24506a169f109875e4ad" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_t</a>* router;</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="types_8h.html#a3154253ddb8f9b8f8f737c91f5973278" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_rule_t</a>* rule;</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    settings = <a class="code" href="settings_8h.html#ad7ab9269a28c2b5852d512ffe3546949" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">new_fluid_settings</a>();</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    synth = <a class="code" href="synth_8h.html#a344f7369c0f57d30f72702d0c88e6178" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">new_fluid_synth</a>(settings);</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <span class="comment" style="color: rgb(128, 0, 0);">/* Create the MIDI router and pass events to the synthesizer */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    router = <a class="code" href="midi_8h.html#ae28ddf804fa5ba108a65c24fcf6e9813" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">new_fluid_midi_router</a> (settings, <a class="code" href="synth_8h.html#a439e1175fa34123b3d0c96a0366d42dd" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_synth_handle_midi_event</a>, synth);</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <span class="comment" style="color: rgb(128, 0, 0);">/* Clear default rules */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="midi_8h.html#a57aed5e84828c202452e13f265dd72f7" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_clear_rules</a> (router);</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <span class="comment" style="color: rgb(128, 0, 0);">/* Add rule to map all notes &lt; MIDI note #60 on any channel to channel 4 */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    rule = <a class="code" href="midi_8h.html#a128bc8b126cbabf7717149123815d235" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">new_fluid_midi_router_rule</a> ();</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="midi_8h.html#acc264709865c1e2dc972528cca55dc6f" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_rule_set_chan</a> (rule, 0, 15, 0.0, 4);      <span class="comment" style="color: rgb(128, 0, 0);">/* Map all to channel 4 */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="midi_8h.html#ac4f572c218943ded7fe43692a265ddb5" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_rule_set_param1</a> (rule, 0, 59, 1.0, 0);    <span class="comment" style="color: rgb(128, 0, 0);">/* Match notes &lt; 60 */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="midi_8h.html#aa1894a103cde4f1efe80c7c9d5096ae2" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_add_rule</a> (router, rule, <a class="code" href="midi_8h.html#ab798a0a5b95607556c9ecfbeaaab962ba44d3968ac6d884210bdace219f17c684" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">FLUID_MIDI_ROUTER_RULE_NOTE</a>);</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <span class="comment" style="color: rgb(128, 0, 0);">/* Add rule to map all notes &gt;= MIDI note #60 on any channel to channel 5 */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    rule = <a class="code" href="midi_8h.html#a128bc8b126cbabf7717149123815d235" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">new_fluid_midi_router_rule</a> ();</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="midi_8h.html#acc264709865c1e2dc972528cca55dc6f" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_rule_set_chan</a> (rule, 0, 15, 0.0, 5);      <span class="comment" style="color: rgb(128, 0, 0);">/* Map all to channel 5 */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="midi_8h.html#ac4f572c218943ded7fe43692a265ddb5" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_rule_set_param1</a> (rule, 60, 127, 1.0, 0);  <span class="comment" style="color: rgb(128, 0, 0);">/* Match notes &gt;= 60 */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="midi_8h.html#aa1894a103cde4f1efe80c7c9d5096ae2" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_add_rule</a> (router, rule, <a class="code" href="midi_8h.html#ab798a0a5b95607556c9ecfbeaaab962ba44d3968ac6d884210bdace219f17c684" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">FLUID_MIDI_ROUTER_RULE_NOTE</a>);</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <span class="comment" style="color: rgb(128, 0, 0);">/* Add rule to reverse direction of pitch bender on channel 7 */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    rule = <a class="code" href="midi_8h.html#a128bc8b126cbabf7717149123815d235" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">new_fluid_midi_router_rule</a> ();</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="midi_8h.html#acc264709865c1e2dc972528cca55dc6f" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_rule_set_chan</a> (rule, 7, 7, 1.0, 0);             <span class="comment" style="color: rgb(128, 0, 0);">/* Match channel 7 only */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="midi_8h.html#ac4f572c218943ded7fe43692a265ddb5" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_rule_set_param1</a> (rule, 0, 16383, -1.0, 16383);  <span class="comment" style="color: rgb(128, 0, 0);">/* Reverse pitch bender */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="midi_8h.html#aa1894a103cde4f1efe80c7c9d5096ae2" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_add_rule</a> (router, rule, <a class="code" href="midi_8h.html#ab798a0a5b95607556c9ecfbeaaab962ba087309f49bb501d67d74a9d5a128e621" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">FLUID_MIDI_ROUTER_RULE_PITCH_BEND</a>);</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <span class="comment" style="color: rgb(128, 0, 0);">/* ... Create audio driver, process events, etc ... */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <span class="comment" style="color: rgb(128, 0, 0);">/* cleanup */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="midi_8h.html#a48f3cd2fcebc5f80c8a9ce43973b9fdc" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">delete_fluid_midi_router</a>(router);</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="synth_8h.html#a585a63f3a25b9df17b82ae87f2d38cfc" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">delete_fluid_synth</a>(synth);</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="settings_8h.html#a550270f09e4f3c645cbe9e6d3c514ca4" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">delete_fluid_settings</a>(settings);</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <span class="keywordflow" style="color: rgb(224, 128, 0);">return</span> 0;</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">}</div></div><br class="Apple-interchange-newline">Ytext/htmlUUTF-8_,http://www.fluidsynth.org/api-1.x/index.htmlP    ( : P n } îs
sssI                           sJOnü     " (                         ¿              √                                          \              _              æ              ¡                                          a              d              z              P        ñlFN∆g              i        !M1Ül              r        !M1Üu              |        !M1ÜÄ              â              ä              ã              å              ê        ⁄6!P8ë†              ´              ¨              ∞        ⁄6!P8ëΩ              ≈              ∆                       ⁄6!P8ë›              Ê              Á              Î        ⁄6!P8ë              
                                    ⁄6!P8ë-              0              1              =        ⁄6!P8ëL              W              Y              ]        ±k  }ú              ù              ™        ⁄6!P8ëø              À        ⁄6!P8ëË              Ò              Û              ˜        ±k  }                                    ⁄6!P8ë2              <              >              B        ±k  }ç              é              ô        ⁄6!P8ë≥              ∑              ∏              º        ⁄6!P8ë€              ¯        ±k  }                                    ⁄6!P8ë8              S        ±k  }i              j              n        ⁄6!P8ëà              ò        ⁄6!P8ë≥              µ              ∑              ª        ±k  }                                    ⁄6!P8ë-              1              2              6        ⁄6!P8ëU              r        ±k  }å              ç              ë        ⁄6!P8ë≤              Õ        ±k  }‰              Â              È        ⁄6!P8ë	              	        ⁄6!P8ë.	              0	              2	              6	        ±k  }v	              w	              Ç	        ⁄6!P8ëú	              †	              °	              •	        ⁄6!P8ëƒ	              Á	        ±k  }
              
              
        ⁄6!P8ë'
              H
        ±k  }b
              c
              g
        ⁄6!P8ëÅ
              ë
        ⁄6!P8ë≤
              ¥
              ∂
              ∫
        ±k  }
              Ú
              ˆ
        ±k  }                                    ⁄6!P8ë               )              *              .        ⁄6!P8ë@              H              I              M        ⁄6!P8ëb              m              n              r        Y◊QlÖx              {              |              }              OEÏ   ÏE           ü          ™           L            J            _            N   	      
   O                  ÷                                                	                                                                      !      "      #   	   $      %      &      '      (      )      *      +      ,      -      .      /      0      1      2   ?   3      4      5      6      7      8   	   9      :      ;      <      =      >      ?   
   @      A      B   K   C      D      E      F      G      H      I      J      K      L      M      N   !   O      P      Q      R      S      T      U      V      W      X      Y   L   Z      [      \      ]      ^      _      `      a      b      c      d      e   !   f      g      h      i      j      k      l      m      n      o      p   @   q      r      s      t      u      v      w      x   #   y      z      {      |   !   }   !   ~            Ä      Å      Ç      É   !   Ñ      Ö      Ü      á   6   à      â      ä      ã      å      ç      é   	   è      ê      ë      í      ì      î      ï      ñ      ó      ò      ô      ö      õ      ú      ù      û   ü   p                         0   dman(                       Helvetica Bold                       l                         ,   dman$                    	   Helvetica                        l                         ,   dman$                    	   Helvetica                        l                         ,   dman$                    	   Helvetica                        l                         ,   dman$                    	   Helvetica                        l                         ,   dman$                    	   Helvetica                        l                         ,   dman$                    	   Helvetica                        l                         ,   dman$                    	   Helvetica                        l                         ,   dman$                    	   Helvetica                        l                         ,   dman$                    	   Helvetica                        l                         ,   dman$                    	   Helvetica                        l                         ,   dman$                    	   Helvetica                        l                         ,   dman$                    	   Helvetica                        l                         ,   dman$                    	   Helvetica                        l                         ,   dman$                    	   Helvetica                        h                         (   dman                        Courier              ~Ä_`   h                         (   dman                        Courier                      h                         (   dman                        Courier              _`>@   h                         (   dman                        Courier                      h                         (   dman                        Courier              _`>@   h                         (   dman                        Courier                      h                         (   dman                        Courier              _`>@   h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              ~Ä      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              ~Ä      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              ~Ä      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier              ~Ä      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier              ~Ä      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              ~Ä      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier              ~Ä      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier              ~Ä      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              ~Ä      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier              ~Ä      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier              ~Ä      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              ~Ä      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              ~Ä      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              FFee°¢  h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier              ﬂ‡~Ä    h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      h                         (   dman                        Courier                      Ouè<h1 style="transition: text-shadow 0.5s linear; margin-right: 15px; caret-color: rgb(0, 0, 0); color: rgb(0, 0, 0); font-family: Roboto, sans-serif; font-style: normal; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none;">Real-time MIDI router</h1><p style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: 22px; font-family: Roboto, sans-serif; caret-color: rgb(0, 0, 0); color: rgb(0, 0, 0); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none;">The MIDI router is one more processing layer directly behind the MIDI input. It processes incoming MIDI events and generates control events for the synth. It can be used to filter or modify events prior to sending them to the synthesizer. When created, the MIDI router is transparent and simply passes all MIDI events. Router "rules" must be added to actually make use of its capabilities.</p><p style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: 22px; font-family: Roboto, sans-serif; caret-color: rgb(0, 0, 0); color: rgb(0, 0, 0); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none;">Some examples of MIDI router usage:</p><ul style="caret-color: rgb(0, 0, 0); color: rgb(0, 0, 0); font-family: Roboto, sans-serif; font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none;"><li>Filter messages (Example: Pass sustain pedal CCs only to selected channels)</li><li>Split the keyboard (Example: noteon with notenr &lt; x: to ch 1, &gt;x to ch 2)</li><li>Layer sounds (Example: for each noteon received on ch 1, create a noteon on ch1, ch2, ch3,...)</li><li>Velocity scaling (Example: for each noteon event, scale the velocity by 1.27)</li><li>Velocity switching (Example: v &lt;= 100: "Angel Choir"; v &gt; 100: "Hell's Bells")</li><li>Get rid of aftertouch</li></ul><p style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: 22px; font-family: Roboto, sans-serif; caret-color: rgb(0, 0, 0); color: rgb(0, 0, 0); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none;">The MIDI driver API has a clean separation between the midi thread and the synthesizer. That opens the door to add a midi router module.</p><p style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: 22px; font-family: Roboto, sans-serif; caret-color: rgb(0, 0, 0); color: rgb(0, 0, 0); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none;">MIDI events coming from the MIDI player do not pass through the MIDI router.</p><div class="fragment" style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: 22px; font-family: Roboto, sans-serif; padding: 0px; margin: 4px 8px 4px 2px; background-color: rgb(251, 252, 253); border: 1px solid rgb(196, 207, 229); caret-color: rgb(0, 0, 0); color: rgb(0, 0, 0); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none;"><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"><span class="preprocessor" style="color: rgb(128, 96, 32);">#include &lt;fluidsynth.h&gt;</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"><span class="keywordtype" style="color: rgb(96, 64, 32);">int</span> main(<span class="keywordtype" style="color: rgb(96, 64, 32);">int</span> argc, <span class="keywordtype" style="color: rgb(96, 64, 32);">char</span>** argv) </div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">{</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="http://www.fluidsynth.org/api-1.x/types_8h.html#aa363402d3c77333b0f070ba531d034ba" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_settings_t</a>* settings;</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="http://www.fluidsynth.org/api-1.x/types_8h.html#ae265f10ae174a13afe010de50d87e1a4" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_synth_t</a>* synth;</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="http://www.fluidsynth.org/api-1.x/types_8h.html#aa57b4746220e24506a169f109875e4ad" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_t</a>* router;</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="http://www.fluidsynth.org/api-1.x/types_8h.html#a3154253ddb8f9b8f8f737c91f5973278" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_rule_t</a>* rule;</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    settings = <a class="code" href="http://www.fluidsynth.org/api-1.x/settings_8h.html#ad7ab9269a28c2b5852d512ffe3546949" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">new_fluid_settings</a>();</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    synth = <a class="code" href="http://www.fluidsynth.org/api-1.x/synth_8h.html#a344f7369c0f57d30f72702d0c88e6178" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">new_fluid_synth</a>(settings);</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <span class="comment" style="color: rgb(128, 0, 0);">/* Create the MIDI router and pass events to the synthesizer */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    router = <a class="code" href="http://www.fluidsynth.org/api-1.x/midi_8h.html#ae28ddf804fa5ba108a65c24fcf6e9813" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">new_fluid_midi_router</a> (settings, <a class="code" href="http://www.fluidsynth.org/api-1.x/synth_8h.html#a439e1175fa34123b3d0c96a0366d42dd" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_synth_handle_midi_event</a>, synth);</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <span class="comment" style="color: rgb(128, 0, 0);">/* Clear default rules */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="http://www.fluidsynth.org/api-1.x/midi_8h.html#a57aed5e84828c202452e13f265dd72f7" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_clear_rules</a> (router);</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <span class="comment" style="color: rgb(128, 0, 0);">/* Add rule to map all notes &lt; MIDI note #60 on any channel to channel 4 */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    rule = <a class="code" href="http://www.fluidsynth.org/api-1.x/midi_8h.html#a128bc8b126cbabf7717149123815d235" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">new_fluid_midi_router_rule</a> ();</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="http://www.fluidsynth.org/api-1.x/midi_8h.html#acc264709865c1e2dc972528cca55dc6f" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_rule_set_chan</a> (rule, 0, 15, 0.0, 4);      <span class="comment" style="color: rgb(128, 0, 0);">/* Map all to channel 4 */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="http://www.fluidsynth.org/api-1.x/midi_8h.html#ac4f572c218943ded7fe43692a265ddb5" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_rule_set_param1</a> (rule, 0, 59, 1.0, 0);    <span class="comment" style="color: rgb(128, 0, 0);">/* Match notes &lt; 60 */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="http://www.fluidsynth.org/api-1.x/midi_8h.html#aa1894a103cde4f1efe80c7c9d5096ae2" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_add_rule</a> (router, rule, <a class="code" href="http://www.fluidsynth.org/api-1.x/midi_8h.html#ab798a0a5b95607556c9ecfbeaaab962ba44d3968ac6d884210bdace219f17c684" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">FLUID_MIDI_ROUTER_RULE_NOTE</a>);</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <span class="comment" style="color: rgb(128, 0, 0);">/* Add rule to map all notes &gt;= MIDI note #60 on any channel to channel 5 */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    rule = <a class="code" href="http://www.fluidsynth.org/api-1.x/midi_8h.html#a128bc8b126cbabf7717149123815d235" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">new_fluid_midi_router_rule</a> ();</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="http://www.fluidsynth.org/api-1.x/midi_8h.html#acc264709865c1e2dc972528cca55dc6f" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_rule_set_chan</a> (rule, 0, 15, 0.0, 5);      <span class="comment" style="color: rgb(128, 0, 0);">/* Map all to channel 5 */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="http://www.fluidsynth.org/api-1.x/midi_8h.html#ac4f572c218943ded7fe43692a265ddb5" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_rule_set_param1</a> (rule, 60, 127, 1.0, 0);  <span class="comment" style="color: rgb(128, 0, 0);">/* Match notes &gt;= 60 */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="http://www.fluidsynth.org/api-1.x/midi_8h.html#aa1894a103cde4f1efe80c7c9d5096ae2" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_add_rule</a> (router, rule, <a class="code" href="http://www.fluidsynth.org/api-1.x/midi_8h.html#ab798a0a5b95607556c9ecfbeaaab962ba44d3968ac6d884210bdace219f17c684" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">FLUID_MIDI_ROUTER_RULE_NOTE</a>);</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <span class="comment" style="color: rgb(128, 0, 0);">/* Add rule to reverse direction of pitch bender on channel 7 */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    rule = <a class="code" href="http://www.fluidsynth.org/api-1.x/midi_8h.html#a128bc8b126cbabf7717149123815d235" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">new_fluid_midi_router_rule</a> ();</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="http://www.fluidsynth.org/api-1.x/midi_8h.html#acc264709865c1e2dc972528cca55dc6f" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_rule_set_chan</a> (rule, 7, 7, 1.0, 0);             <span class="comment" style="color: rgb(128, 0, 0);">/* Match channel 7 only */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="http://www.fluidsynth.org/api-1.x/midi_8h.html#ac4f572c218943ded7fe43692a265ddb5" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_rule_set_param1</a> (rule, 0, 16383, -1.0, 16383);  <span class="comment" style="color: rgb(128, 0, 0);">/* Reverse pitch bender */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="http://www.fluidsynth.org/api-1.x/midi_8h.html#aa1894a103cde4f1efe80c7c9d5096ae2" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">fluid_midi_router_add_rule</a> (router, rule, <a class="code" href="http://www.fluidsynth.org/api-1.x/midi_8h.html#ab798a0a5b95607556c9ecfbeaaab962ba087309f49bb501d67d74a9d5a128e621" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">FLUID_MIDI_ROUTER_RULE_PITCH_BEND</a>);</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <span class="comment" style="color: rgb(128, 0, 0);">/* ... Create audio driver, process events, etc ... */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;"></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <span class="comment" style="color: rgb(128, 0, 0);">/* cleanup */</span></div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="http://www.fluidsynth.org/api-1.x/midi_8h.html#a48f3cd2fcebc5f80c8a9ce43973b9fdc" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">delete_fluid_midi_router</a>(router);</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="http://www.fluidsynth.org/api-1.x/synth_8h.html#a585a63f3a25b9df17b82ae87f2d38cfc" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">delete_fluid_synth</a>(synth);</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <a class="code" href="http://www.fluidsynth.org/api-1.x/settings_8h.html#a550270f09e4f3c645cbe9e6d3c514ca4" style="color: rgb(70, 101, 162); font-weight: normal; text-decoration: none;">delete_fluid_settings</a>(settings);</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">    <span class="keywordflow" style="color: rgb(224, 128, 0);">return</span> 0;</div><div class="line" style="font-style: normal; font-variant-caps: normal; font-weight: 400; font-stretch: normal; font-size: 13px; line-height: 1; font-family: monospace, fixed; min-height: 13px; white-space: pre-wrap; word-wrap: break-word; text-indent: -53px; padding-left: 53px; padding-bottom: 0px; margin: 0px; transition-property: background-color, box-shadow; transition-duration: 0.5s;">}</div></div><br class="Apple-interchange-newline">_&a{\rtf1\ansi\ansicpg1252\cocoartf1504\cocoasubrtf840
{\fonttbl\f0\fswiss\fcharset0 Helvetica;\f1\fmodern\fcharset0 Courier;}
{\colortbl;\red255\green255\blue255;\red0\green0\blue0;\red108\green78\blue25;\red250\green251\blue252;
\red77\green49\blue24;\red55\green80\blue145;\red107\green0\blue1;\red215\green108\blue6;}
{\*\expandedcolortbl;;\cssrgb\c0\c0\c0;\cssrgb\c50196\c37647\c12549;\cssrgb\c98431\c98824\c99216;
\cssrgb\c37647\c25098\c12549;\cssrgb\c27451\c39608\c63529;\cssrgb\c50196\c0\c0;\cssrgb\c87843\c50196\c0;}
{\*\listtable{\list\listtemplateid1\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid1}}
{\*\listoverridetable{\listoverride\listid1\listoverridecount0\ls1}}
\deftab720
\pard\pardeftab720\partightenfactor0

\f0\b\fs56 \cf0 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Real-time MIDI router\
\pard\pardeftab720\partightenfactor0

\b0\fs28 \cf0 The MIDI router is one more processing layer directly behind the MIDI input. It processes incoming MIDI events and generates control events for the synth. It can be used to filter or modify events prior to sending them to the synthesizer. When created, the MIDI router is transparent and simply passes all MIDI events. Router "rules" must be added to actually make use of its capabilities.\
Some examples of MIDI router usage:\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls1\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\'95	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Filter messages (Example: Pass sustain pedal CCs only to selected channels)\
\ls1\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\'95	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Split the keyboard (Example: noteon with notenr < x: to ch 1, >x to ch 2)\
\ls1\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\'95	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Layer sounds (Example: for each noteon received on ch 1, create a noteon on ch1, ch2, ch3,...)\
\ls1\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\'95	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Velocity scaling (Example: for each noteon event, scale the velocity by 1.27)\
\ls1\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\'95	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Velocity switching (Example: v <= 100: "Angel Choir"; v > 100: "Hell's Bells")\
\ls1\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\'95	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Get rid of aftertouch\
\pard\pardeftab720\partightenfactor0
\cf0 The MIDI driver API has a clean separation between the midi thread and the synthesizer. That opens the door to add a midi router module.\
MIDI events coming from the MIDI player do not pass through the MIDI router.\
\pard\pardeftab720\partightenfactor0

\f1\fs26 \cf3 \cb4 \strokec3 #include <fluidsynth.h>\cf0 \cb1 \strokec2 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb4 \strokec5 int\cf0 \strokec2  main(\cf5 \strokec5 int\cf0 \strokec2  argc, \cf5 \strokec5 char\cf0 \strokec2 ** argv) \cb1 \
\pard\pardeftab720\partightenfactor0
\cf0 \cb4 \{\cb1 \
\cb4     {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/types_8h.html#aa363402d3c77333b0f070ba531d034ba"}}{\fldrslt \cf6 \strokec6 fluid_settings_t}}* settings;\cb1 \
\cb4     {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/types_8h.html#ae265f10ae174a13afe010de50d87e1a4"}}{\fldrslt \cf6 \strokec6 fluid_synth_t}}* synth;\cb1 \
\cb4     {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/types_8h.html#aa57b4746220e24506a169f109875e4ad"}}{\fldrslt \cf6 \strokec6 fluid_midi_router_t}}* router;\cb1 \
\cb4     {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/types_8h.html#a3154253ddb8f9b8f8f737c91f5973278"}}{\fldrslt \cf6 \strokec6 fluid_midi_router_rule_t}}* rule;\cb1 \
\
\cb4     settings = {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/settings_8h.html#ad7ab9269a28c2b5852d512ffe3546949"}}{\fldrslt \cf6 \strokec6 new_fluid_settings}}();\cb1 \
\cb4     synth = {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/synth_8h.html#a344f7369c0f57d30f72702d0c88e6178"}}{\fldrslt \cf6 \strokec6 new_fluid_synth}}(settings);\cb1 \
\
\cb4     \cf7 \strokec7 /* Create the MIDI router and pass events to the synthesizer */\cf0 \cb1 \strokec2 \
\cb4     router = {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/midi_8h.html#ae28ddf804fa5ba108a65c24fcf6e9813"}}{\fldrslt \cf6 \strokec6 new_fluid_midi_router}} (settings, {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/synth_8h.html#a439e1175fa34123b3d0c96a0366d42dd"}}{\fldrslt \cf6 \strokec6 fluid_synth_handle_midi_event}}, synth);\cb1 \
\
\cb4     \cf7 \strokec7 /* Clear default rules */\cf0 \cb1 \strokec2 \
\cb4     {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/midi_8h.html#a57aed5e84828c202452e13f265dd72f7"}}{\fldrslt \cf6 \strokec6 fluid_midi_router_clear_rules}} (router);\cb1 \
\
\cb4     \cf7 \strokec7 /* Add rule to map all notes < MIDI note #60 on any channel to channel 4 */\cf0 \cb1 \strokec2 \
\cb4     rule = {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/midi_8h.html#a128bc8b126cbabf7717149123815d235"}}{\fldrslt \cf6 \strokec6 new_fluid_midi_router_rule}} ();\cb1 \
\cb4     {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/midi_8h.html#acc264709865c1e2dc972528cca55dc6f"}}{\fldrslt \cf6 \strokec6 fluid_midi_router_rule_set_chan}} (rule, 0, 15, 0.0, 4);      \cf7 \strokec7 /* Map all to channel 4 */\cf0 \cb1 \strokec2 \
\cb4     {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/midi_8h.html#ac4f572c218943ded7fe43692a265ddb5"}}{\fldrslt \cf6 \strokec6 fluid_midi_router_rule_set_param1}} (rule, 0, 59, 1.0, 0);    \cf7 \strokec7 /* Match notes < 60 */\cf0 \cb1 \strokec2 \
\cb4     {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/midi_8h.html#aa1894a103cde4f1efe80c7c9d5096ae2"}}{\fldrslt \cf6 \strokec6 fluid_midi_router_add_rule}} (router, rule, {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/midi_8h.html#ab798a0a5b95607556c9ecfbeaaab962ba44d3968ac6d884210bdace219f17c684"}}{\fldrslt \cf6 \strokec6 FLUID_MIDI_ROUTER_RULE_NOTE}});\cb1 \
\
\cb4     \cf7 \strokec7 /* Add rule to map all notes >= MIDI note #60 on any channel to channel 5 */\cf0 \cb1 \strokec2 \
\cb4     rule = {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/midi_8h.html#a128bc8b126cbabf7717149123815d235"}}{\fldrslt \cf6 \strokec6 new_fluid_midi_router_rule}} ();\cb1 \
\cb4     {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/midi_8h.html#acc264709865c1e2dc972528cca55dc6f"}}{\fldrslt \cf6 \strokec6 fluid_midi_router_rule_set_chan}} (rule, 0, 15, 0.0, 5);      \cf7 \strokec7 /* Map all to channel 5 */\cf0 \cb1 \strokec2 \
\cb4     {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/midi_8h.html#ac4f572c218943ded7fe43692a265ddb5"}}{\fldrslt \cf6 \strokec6 fluid_midi_router_rule_set_param1}} (rule, 60, 127, 1.0, 0);  \cf7 \strokec7 /* Match notes >= 60 */\cf0 \cb1 \strokec2 \
\cb4     {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/midi_8h.html#aa1894a103cde4f1efe80c7c9d5096ae2"}}{\fldrslt \cf6 \strokec6 fluid_midi_router_add_rule}} (router, rule, {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/midi_8h.html#ab798a0a5b95607556c9ecfbeaaab962ba44d3968ac6d884210bdace219f17c684"}}{\fldrslt \cf6 \strokec6 FLUID_MIDI_ROUTER_RULE_NOTE}});\cb1 \
\
\cb4     \cf7 \strokec7 /* Add rule to reverse direction of pitch bender on channel 7 */\cf0 \cb1 \strokec2 \
\cb4     rule = {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/midi_8h.html#a128bc8b126cbabf7717149123815d235"}}{\fldrslt \cf6 \strokec6 new_fluid_midi_router_rule}} ();\cb1 \
\cb4     {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/midi_8h.html#acc264709865c1e2dc972528cca55dc6f"}}{\fldrslt \cf6 \strokec6 fluid_midi_router_rule_set_chan}} (rule, 7, 7, 1.0, 0);             \cf7 \strokec7 /* Match channel 7 only */\cf0 \cb1 \strokec2 \
\cb4     {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/midi_8h.html#ac4f572c218943ded7fe43692a265ddb5"}}{\fldrslt \cf6 \strokec6 fluid_midi_router_rule_set_param1}} (rule, 0, 16383, -1.0, 16383);  \cf7 \strokec7 /* Reverse pitch bender */\cf0 \cb1 \strokec2 \
\cb4     {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/midi_8h.html#aa1894a103cde4f1efe80c7c9d5096ae2"}}{\fldrslt \cf6 \strokec6 fluid_midi_router_add_rule}} (router, rule, {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/midi_8h.html#ab798a0a5b95607556c9ecfbeaaab962ba087309f49bb501d67d74a9d5a128e621"}}{\fldrslt \cf6 \strokec6 FLUID_MIDI_ROUTER_RULE_PITCH_BEND}});\cb1 \
\
\cb4     \cf7 \strokec7 /* ... Create audio driver, process events, etc ... */\cf0 \cb1 \strokec2 \
\
\cb4     \cf7 \strokec7 /* cleanup */\cf0 \cb1 \strokec2 \
\cb4     {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/midi_8h.html#a48f3cd2fcebc5f80c8a9ce43973b9fdc"}}{\fldrslt \cf6 \strokec6 delete_fluid_midi_router}}(router);\cb1 \
\cb4     {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/synth_8h.html#a585a63f3a25b9df17b82ae87f2d38cfc"}}{\fldrslt \cf6 \strokec6 delete_fluid_synth}}(synth);\cb1 \
\cb4     {\field{\*\fldinst{HYPERLINK "http://www.fluidsynth.org/api-1.x/settings_8h.html#a550270f09e4f3c645cbe9e6d3c514ca4"}}{\fldrslt \cf6 \strokec6 delete_fluid_settings}}(settings);\cb1 \
\cb4     \cf8 \strokec8 return\cf0 \strokec2  0;\cb1 \
\cb4 \}\cb1 \
}O–R e a l - t i m e   M I D I   r o u t e r   T h e   M I D I   r o u t e r   i s   o n e   m o r e   p r o c e s s i n g   l a y e r   d i r e c t l y   b e h i n d   t h e   M I D I   i n p u t .   I t   p r o c e s s e s   i n c o m i n g   M I D I   e v e n t s   a n d   g e n e r a t e s   c o n t r o l   e v e n t s   f o r   t h e   s y n t h .   I t   c a n   b e   u s e d   t o   f i l t e r   o r   m o d i f y   e v e n t s   p r i o r   t o   s e n d i n g   t h e m   t o   t h e   s y n t h e s i z e r .   W h e n   c r e a t e d ,   t h e   M I D I   r o u t e r   i s   t r a n s p a r e n t   a n d   s i m p l y   p a s s e s   a l l   M I D I   e v e n t s .   R o u t e r   " r u l e s "   m u s t   b e   a d d e d   t o   a c t u a l l y   m a k e   u s e   o f   i t s   c a p a b i l i t i e s .   S o m e   e x a m p l e s   o f   M I D I   r o u t e r   u s a g e :   F i l t e r   m e s s a g e s   ( E x a m p l e :   P a s s   s u s t a i n   p e d a l   C C s   o n l y   t o   s e l e c t e d   c h a n n e l s )  S p l i t   t h e   k e y b o a r d   ( E x a m p l e :   n o t e o n   w i t h   n o t e n r   <   x :   t o   c h   1 ,   > x   t o   c h   2 )  L a y e r   s o u n d s   ( E x a m p l e :   f o r   e a c h   n o t e o n   r e c e i v e d   o n   c h   1 ,   c r e a t e   a   n o t e o n   o n   c h 1 ,   c h 2 ,   c h 3 , . . . )  V e l o c i t y   s c a l i n g   ( E x a m p l e :   f o r   e a c h   n o t e o n   e v e n t ,   s c a l e   t h e   v e l o c i t y   b y   1 . 2 7 )  V e l o c i t y   s w i t c h i n g   ( E x a m p l e :   v   < =   1 0 0 :   " A n g e l   C h o i r " ;   v   >   1 0 0 :   " H e l l ' s   B e l l s " )  G e t   r i d   o f   a f t e r t o u c h  T h e   M I D I   d r i v e r   A P I   h a s   a   c l e a n   s e p a r a t i o n   b e t w e e n   t h e   m i d i   t h r e a d   a n d   t h e   s y n t h e s i z e r .   T h a t   o p e n s   t h e   d o o r   t o   a d d   a   m i d i   r o u t e r   m o d u l e .   M I D I   e v e n t s   c o m i n g   f r o m   t h e   M I D I   p l a y e r   d o   n o t   p a s s   t h r o u g h   t h e   M I D I   r o u t e r .   # i n c l u d e   < f l u i d s y n t h . h >  i n t   m a i n ( i n t   a r g c ,   c h a r * *   a r g v )    {          f l u i d _ s e t t i n g s _ t *   s e t t i n g s ;          f l u i d _ s y n t h _ t *   s y n t h ;          f l u i d _ m i d i _ r o u t e r _ t *   r o u t e r ;          f l u i d _ m i d i _ r o u t e r _ r u l e _ t *   r u l e ;          s e t t i n g s   =   n e w _ f l u i d _ s e t t i n g s ( ) ;          s y n t h   =   n e w _ f l u i d _ s y n t h ( s e t t i n g s ) ;          / *   C r e a t e   t h e   M I D I   r o u t e r   a n d   p a s s   e v e n t s   t o   t h e   s y n t h e s i z e r   * /          r o u t e r   =   n e w _ f l u i d _ m i d i _ r o u t e r   ( s e t t i n g s ,   f l u i d _ s y n t h _ h a n d l e _ m i d i _ e v e n t ,   s y n t h ) ;          / *   C l e a r   d e f a u l t   r u l e s   * /          f l u i d _ m i d i _ r o u t e r _ c l e a r _ r u l e s   ( r o u t e r ) ;          / *   A d d   r u l e   t o   m a p   a l l   n o t e s   <   M I D I   n o t e   # 6 0   o n   a n y   c h a n n e l   t o   c h a n n e l   4   * /          r u l e   =   n e w _ f l u i d _ m i d i _ r o u t e r _ r u l e   ( ) ;          f l u i d _ m i d i _ r o u t e r _ r u l e _ s e t _ c h a n   ( r u l e ,   0 ,   1 5 ,   0 . 0 ,   4 ) ;             / *   M a p   a l l   t o   c h a n n e l   4   * /          f l u i d _ m i d i _ r o u t e r _ r u l e _ s e t _ p a r a m 1   ( r u l e ,   0 ,   5 9 ,   1 . 0 ,   0 ) ;         / *   M a t c h   n o t e s   <   6 0   * /          f l u i d _ m i d i _ r o u t e r _ a d d _ r u l e   ( r o u t e r ,   r u l e ,   F L U I D _ M I D I _ R O U T E R _ R U L E _ N O T E ) ;          / *   A d d   r u l e   t o   m a p   a l l   n o t e s   > =   M I D I   n o t e   # 6 0   o n   a n y   c h a n n e l   t o   c h a n n e l   5   * /          r u l e   =   n e w _ f l u i d _ m i d i _ r o u t e r _ r u l e   ( ) ;          f l u i d _ m i d i _ r o u t e r _ r u l e _ s e t _ c h a n   ( r u l e ,   0 ,   1 5 ,   0 . 0 ,   5 ) ;             / *   M a p   a l l   t o   c h a n n e l   5   * /          f l u i d _ m i d i _ r o u t e r _ r u l e _ s e t _ p a r a m 1   ( r u l e ,   6 0 ,   1 2 7 ,   1 . 0 ,   0 ) ;     / *   M a t c h   n o t e s   > =   6 0   * /          f l u i d _ m i d i _ r o u t e r _ a d d _ r u l e   ( r o u t e r ,   r u l e ,   F L U I D _ M I D I _ R O U T E R _ R U L E _ N O T E ) ;          / *   A d d   r u l e   t o   r e v e r s e   d i r e c t i o n   o f   p i t c h   b e n d e r   o n   c h a n n e l   7   * /          r u l e   =   n e w _ f l u i d _ m i d i _ r o u t e r _ r u l e   ( ) ;          f l u i d _ m i d i _ r o u t e r _ r u l e _ s e t _ c h a n   ( r u l e ,   7 ,   7 ,   1 . 0 ,   0 ) ;                           / *   M a t c h   c h a n n e l   7   o n l y   * /          f l u i d _ m i d i _ r o u t e r _ r u l e _ s e t _ p a r a m 1   ( r u l e ,   0 ,   1 6 3 8 3 ,   - 1 . 0 ,   1 6 3 8 3 ) ;     / *   R e v e r s e   p i t c h   b e n d e r   * /          f l u i d _ m i d i _ r o u t e r _ a d d _ r u l e   ( r o u t e r ,   r u l e ,   F L U I D _ M I D I _ R O U T E R _ R U L E _ P I T C H _ B E N D ) ;          / *   . . .   C r e a t e   a u d i o   d r i v e r ,   p r o c e s s   e v e n t s ,   e t c   . . .   * /          / *   c l e a n u p   * /          d e l e t e _ f l u i d _ m i d i _ r o u t e r ( r o u t e r ) ;          d e l e t e _ f l u i d _ s y n t h ( s y n t h ) ;          d e l e t e _ f l u i d _ s e t t i n g s ( s e t t i n g s ) ;          r e t u r n   0 ;  }  O˛ˇ˛R e a l - t i m e   M I D I   r o u t e r  T h e   M I D I   r o u t e r   i s   o n e   m o r e   p r o c e s s i n g   l a y e r   d i r e c t l y   b e h i n d   t h e   M I D I   i n p u t .   I t   p r o c e s s e s   i n c o m i n g   M I D I   e v e n t s   a n d   g e n e r a t e s   c o n t r o l   e v e n t s   f o r   t h e   s y n t h .   I t   c a n   b e   u s e d   t o   f i l t e r   o r   m o d i f y   e v e n t s   p r i o r   t o   s e n d i n g   t h e m   t o   t h e   s y n t h e s i z e r .   W h e n   c r e a t e d ,   t h e   M I D I   r o u t e r   i s   t r a n s p a r e n t   a n d   s i m p l y   p a s s e s   a l l   M I D I   e v e n t s .   R o u t e r   " r u l e s "   m u s t   b e   a d d e d   t o   a c t u a l l y   m a k e   u s e   o f   i t s   c a p a b i l i t i e s .  S o m e   e x a m p l e s   o f   M I D I   r o u t e r   u s a g e :  	 " 	 F i l t e r   m e s s a g e s   ( E x a m p l e :   P a s s   s u s t a i n   p e d a l   C C s   o n l y   t o   s e l e c t e d   c h a n n e l s )  	 " 	 S p l i t   t h e   k e y b o a r d   ( E x a m p l e :   n o t e o n   w i t h   n o t e n r   <   x :   t o   c h   1 ,   > x   t o   c h   2 )  	 " 	 L a y e r   s o u n d s   ( E x a m p l e :   f o r   e a c h   n o t e o n   r e c e i v e d   o n   c h   1 ,   c r e a t e   a   n o t e o n   o n   c h 1 ,   c h 2 ,   c h 3 , . . . )  	 " 	 V e l o c i t y   s c a l i n g   ( E x a m p l e :   f o r   e a c h   n o t e o n   e v e n t ,   s c a l e   t h e   v e l o c i t y   b y   1 . 2 7 )  	 " 	 V e l o c i t y   s w i t c h i n g   ( E x a m p l e :   v   < =   1 0 0 :   " A n g e l   C h o i r " ;   v   >   1 0 0 :   " H e l l ' s   B e l l s " )  	 " 	 G e t   r i d   o f   a f t e r t o u c h  T h e   M I D I   d r i v e r   A P I   h a s   a   c l e a n   s e p a r a t i o n   b e t w e e n   t h e   m i d i   t h r e a d   a n d   t h e   s y n t h e s i z e r .   T h a t   o p e n s   t h e   d o o r   t o   a d d   a   m i d i   r o u t e r   m o d u l e .  M I D I   e v e n t s   c o m i n g   f r o m   t h e   M I D I   p l a y e r   d o   n o t   p a s s   t h r o u g h   t h e   M I D I   r o u t e r .  # i n c l u d e   < f l u i d s y n t h . h >   i n t   m a i n ( i n t   a r g c ,   c h a r * *   a r g v )    {          f l u i d _ s e t t i n g s _ t *   s e t t i n g s ;          f l u i d _ s y n t h _ t *   s y n t h ;          f l u i d _ m i d i _ r o u t e r _ t *   r o u t e r ;          f l u i d _ m i d i _ r o u t e r _ r u l e _ t *   r u l e ;           s e t t i n g s   =   n e w _ f l u i d _ s e t t i n g s ( ) ;          s y n t h   =   n e w _ f l u i d _ s y n t h ( s e t t i n g s ) ;           / *   C r e a t e   t h e   M I D I   r o u t e r   a n d   p a s s   e v e n t s   t o   t h e   s y n t h e s i z e r   * /          r o u t e r   =   n e w _ f l u i d _ m i d i _ r o u t e r   ( s e t t i n g s ,   f l u i d _ s y n t h _ h a n d l e _ m i d i _ e v e n t ,   s y n t h ) ;           / *   C l e a r   d e f a u l t   r u l e s   * /          f l u i d _ m i d i _ r o u t e r _ c l e a r _ r u l e s   ( r o u t e r ) ;           / *   A d d   r u l e   t o   m a p   a l l   n o t e s   <   M I D I   n o t e   # 6 0   o n   a n y   c h a n n e l   t o   c h a n n e l   4   * /          r u l e   =   n e w _ f l u i d _ m i d i _ r o u t e r _ r u l e   ( ) ;          f l u i d _ m i d i _ r o u t e r _ r u l e _ s e t _ c h a n   ( r u l e ,   0 ,   1 5 ,   0 . 0 ,   4 ) ;             / *   M a p   a l l   t o   c h a n n e l   4   * /          f l u i d _ m i d i _ r o u t e r _ r u l e _ s e t _ p a r a m 1   ( r u l e ,   0 ,   5 9 ,   1 . 0 ,   0 ) ;         / *   M a t c h   n o t e s   <   6 0   * /          f l u i d _ m i d i _ r o u t e r _ a d d _ r u l e   ( r o u t e r ,   r u l e ,   F L U I D _ M I D I _ R O U T E R _ R U L E _ N O T E ) ;           / *   A d d   r u l e   t o   m a p   a l l   n o t e s   > =   M I D I   n o t e   # 6 0   o n   a n y   c h a n n e l   t o   c h a n n e l   5   * /          r u l e   =   n e w _ f l u i d _ m i d i _ r o u t e r _ r u l e   ( ) ;          f l u i d _ m i d i _ r o u t e r _ r u l e _ s e t _ c h a n   ( r u l e ,   0 ,   1 5 ,   0 . 0 ,   5 ) ;             / *   M a p   a l l   t o   c h a n n e l   5   * /          f l u i d _ m i d i _ r o u t e r _ r u l e _ s e t _ p a r a m 1   ( r u l e ,   6 0 ,   1 2 7 ,   1 . 0 ,   0 ) ;     / *   M a t c h   n o t e s   > =   6 0   * /          f l u i d _ m i d i _ r o u t e r _ a d d _ r u l e   ( r o u t e r ,   r u l e ,   F L U I D _ M I D I _ R O U T E R _ R U L E _ N O T E ) ;           / *   A d d   r u l e   t o   r e v e r s e   d i r e c t i o n   o f   p i t c h   b e n d e r   o n   c h a n n e l   7   * /          r u l e   =   n e w _ f l u i d _ m i d i _ r o u t e r _ r u l e   ( ) ;          f l u i d _ m i d i _ r o u t e r _ r u l e _ s e t _ c h a n   ( r u l e ,   7 ,   7 ,   1 . 0 ,   0 ) ;                           / *   M a t c h   c h a n n e l   7   o n l y   * /          f l u i d _ m i d i _ r o u t e r _ r u l e _ s e t _ p a r a m 1   ( r u l e ,   0 ,   1 6 3 8 3 ,   - 1 . 0 ,   1 6 3 8 3 ) ;     / *   R e v e r s e   p i t c h   b e n d e r   * /          f l u i d _ m i d i _ r o u t e r _ a d d _ r u l e   ( r o u t e r ,   r u l e ,   F L U I D _ M I D I _ R O U T E R _ R U L E _ P I T C H _ B E N D ) ;           / *   . . .   C r e a t e   a u d i o   d r i v e r ,   p r o c e s s   e v e n t s ,   e t c   . . .   * /           / *   c l e a n u p   * /          d e l e t e _ f l u i d _ m i d i _ r o u t e r ( r o u t e r ) ;          d e l e t e _ f l u i d _ s y n t h ( s y n t h ) ;          d e l e t e _ f l u i d _ s e t t i n g s ( s e t t i n g s ) ;          r e t u r n   0 ;  }              '   @   g   ~   ü   ¿   Ã   ◊   Ò    Ä    ãä  ó¸  ›Ï S y‰ ê∏                          ß∫